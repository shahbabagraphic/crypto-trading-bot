// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Post {
  id        String   @id @default(cuid())
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cryptocurrency {
  id          String   @id @default(cuid())
  symbol      String   @unique
  name        String
  price       Float
  change24h   Float
  volume24h   Float
  marketCap   Float
  lastUpdated DateTime @updatedAt
  createdAt   DateTime @default(now())
  pricePoints PricePoint[]
  signals     Signal[]
  portfolios  Portfolio[]
  priceAlerts PriceAlert[]
  tradeJournals TradeJournal[]
}

model PricePoint {
  id                 String   @id @default(cuid())
  cryptocurrencyId   String
  cryptocurrency     Cryptocurrency @relation(fields: [cryptocurrencyId], references: [id], onDelete: Cascade)
  price              Float
  timestamp          DateTime
  createdAt          DateTime @default(now())
  
  @@index([cryptocurrencyId, timestamp])
}

model Signal {
  id               String   @id @default(cuid())
  cryptocurrencyId String
  cryptocurrency   Cryptocurrency @relation(fields: [cryptocurrencyId], references: [id], onDelete: Cascade)
  type             String   // "BUY" or "SELL"
  strength         Int      // 1-100, confidence level
  price            Float
  stopLoss         String?  // JSON string or float
  takeProfit       String?  // JSON string or float
  riskReward       String?  // e.g., "2.5:1"
  confidence       String?  // "Low", "Medium", "High", "Very High"
  trendDirection   String?  // "Uptrend", "Downtrend", "Range"
  marketStructure  String?  // "Bullish Structure", "Bearish Structure", "Consolidation Range"
  reasoning        String
  indicators       String   // JSON string of technical indicators
  executed         Boolean  @default(false)
  result           String?  // "WIN", "LOSS", "BREAKEVEN", "PENDING"
  resultPrice      Float?
  profitLoss       Float?
  timestamp        DateTime @default(now())
  executedAt       DateTime?

  @@index([cryptocurrencyId, timestamp])
  @@index([type, timestamp])
  @@index([executed, timestamp])
  @@index([result])
}

model Portfolio {
  id                 String   @id @default(cuid())
  cryptocurrencyId   String
  cryptocurrency     Cryptocurrency @relation(fields: [cryptocurrencyId], references: [id], onDelete: Cascade)
  amount             Float
  averagePrice       Float
  currentPrice       Float
  currentValue      Float
  profitLoss         Float
  profitLossPercent  Float
  notes              String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([cryptocurrencyId])
}

model PriceAlert {
  id                 String   @id @default(cuid())
  cryptocurrencyId   String
  cryptocurrency     Cryptocurrency @relation(fields: [cryptocurrencyId], references: [id], onDelete: Cascade)
  targetPrice        Float
  condition           String   // "ABOVE" or "BELOW"
  triggered          Boolean  @default(false)
  triggeredAt        DateTime?
  createdAt          DateTime @default(now())

  @@index([cryptocurrencyId, triggered])
}

model TradeJournal {
  id                 String   @id @default(cuid())
  cryptocurrencyId   String
  cryptocurrency     Cryptocurrency @relation(fields: [cryptocurrencyId], references: [id], onDelete: Cascade)
  type               String   // "BUY" or "SELL"
  entryPrice         Float
  exitPrice          Float?
  amount             Float
  positionSize       Float
  stopLoss           Float?
  takeProfit         Float?
  realizedProfit      Float?
  realizedProfitPercent Float?
  strategy           String?
  outcome            String?   // "WIN", "LOSS", "BREAKEVEN", "PENDING"
  notes              String?
  emotions           String?   // Trading emotions
  lessons            String?   // Key lessons learned
  screenshotUrl       String?
  entryTime          DateTime
  exitTime           DateTime?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([cryptocurrencyId, entryTime])
  @@index([outcome, entryTime])
}

